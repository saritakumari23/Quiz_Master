<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Start Quiz - {{ quiz.subject }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    
    <style>
        #timer {
            font-size: 22px;
            font-weight: bold;
            color: red;
            text-align: center;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <h2 class="text-center">Quiz: {{ quiz.subject.name }}</h2>

    <!-- Timer Display -->
    <div id="timer">Time Left: <span id="countdown"></span></div>

    <div class="card mt-4 shadow">
        <div class="card-body">
            <form id="quizForm" method="POST" action="{{ url_for('main.submit_quiz', quiz_id=quiz.id) }}">
                {% for q in questions %}
                <div class="mb-4">
                    <p><strong>Q{{ loop.index }}: {{ q.question_statement }}</strong></p>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="question_{{ q.id }}" value="1" required>
                        <label class="form-check-label">{{ q.option1 }}</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="question_{{ q.id }}" value="2">
                        <label class="form-check-label">{{ q.option2 }}</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="question_{{ q.id }}" value="3">
                        <label class="form-check-label">{{ q.option3 }}</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="question_{{ q.id }}" value="4">
                        <label class="form-check-label">{{ q.option4 }}</label>
                    </div>
                </div>
                <hr>
                {% endfor %}
                <button type="submit" class="btn btn-primary" >Submit Quiz</button>
                <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary">Cancel</a>
            </form>
        </div>
    </div>
</div>

<!-- Timer Script -->
<script>
    let duration = {{ quiz.time_duration }} * 60; // Convert minutes to seconds

    function startTimer() {
        function updateTimer() {
            let hours = Math.floor(duration / 3600);
            let minutes = Math.floor((duration % 3600) / 60);
            let seconds = duration % 60;

            let formattedTime = 
                (hours > 0 ? hours.toString().padStart(2, '0') + ":" : "") + 
                minutes.toString().padStart(2, '0') + ":" + 
                seconds.toString().padStart(2, '0');

            document.getElementById("countdown").textContent = formattedTime;

            if (duration <= 0) {
                clearInterval(countdown);
                alert("Time's up! Submitting your quiz.");
                document.getElementById("quizForm").submit(); // Auto-submit quiz
            } else {
                duration--;
            }
        }

        updateTimer(); // Update immediately
        let countdown = setInterval(updateTimer, 1000);
    }

    window.onload = startTimer;
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
